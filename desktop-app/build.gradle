plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.9.22'
    id 'org.jetbrains.compose' version '1.6.0'
}

repositories {
    mavenCentral()
    maven { url "https://maven.pkg.jetbrains.space/public/p/compose/dev" }
    google()
}

dependencies {
    implementation compose.desktop.currentOs
    implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.9.22'
}

compose.desktop {
    application {
        mainClass = "com.malaria.MainKt"

        nativeDistributions {
            targetFormats(
                    org.jetbrains.compose.desktop.application.dsl.TargetFormat.Msi,
                    org.jetbrains.compose.desktop.application.dsl.TargetFormat.Dmg,
                    org.jetbrains.compose.desktop.application.dsl.TargetFormat.Deb
            )

            packageName = "MalariaDetector"
            packageVersion = "1.0.0"

            windows {
                menuGroup = "Medical Applications"
                upgradeUuid = "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
            }

            macOS {
                bundleID = "com.malaria.detector"
                dockName = "Malaria Detector"
            }

            linux {
                menuGroup = "Medical"
                appCategory = "Science"
            }
        }
    }
}

compileKotlin {
    kotlinOptions.jvmTarget = "17"
}

// Принудительная сборка всех форматов
tasks.register('buildAll') {
    dependsOn 'packageMsi', 'packageDmg', 'packageDeb'
}